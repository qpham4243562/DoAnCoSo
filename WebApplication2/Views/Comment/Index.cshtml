@using System.Security.Claims
@model IEnumerable<DoAnCoSoAPI.Entities.User_comment>

<h2>Comments</h2>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
@if (Model != null && Model.Any())
{
    <ul>
        @foreach (var comment in Model)
        {
            <li>
                <div>@comment.comment</div>
                <div>Created At: @comment.createdAt</div>
                <div>User Name: @comment.UserName</div>
                @if (User.Identity.IsAuthenticated && comment.CreatorId == User.FindFirst(ClaimTypes.NameIdentifier)?.Value)
                {
                    <form id="deleteCommentForm" method="post" action="/DeleteComment/@ViewBag.PostId/@comment.id">
                        <div>
                            <button id="delete-btn" type="submit">Delete</button>
                        </div>
                    </form>



                }
            </li>
        }
    </ul>
}
else
{
    <p>No comments found.</p>
}
<input type="text" id="commentInput" placeholder="Type your comment here..." />
<button id="createCommentButton">Create</button>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        // Xử lý sự kiện khi nhấn Enter trong input
        $("#commentInput").keypress(function (event) {
            if (event.which == 13) { // Nếu nhấn phím Enter
                event.preventDefault(); // Ngăn chặn hành động mặc định của phím Enter
                addComment(); // Gọi hàm thêm comment
            }
        });

        // Xử lý sự kiện khi click vào nút "Create"
        $("#createCommentButton").click(function () {
            addComment(); // Gọi hàm thêm comment
        });

        // Hàm thêm comment
        function addComment() {
            var commentText = $("#commentInput").val(); // Lấy nội dung comment từ input
            $.ajax({
                url: "/AddComment/@ViewBag.PostId", // Đường dẫn của action xử lý thêm comment (chú ý truyền postId)
                method: "POST",
                data: { comment: commentText }, // Dữ liệu gửi đi (nội dung comment)
                success: function () {
                    window.location.reload();
                    // Thêm comment thành công, làm gì đó nếu cần
                    // Ví dụ: Cập nhật danh sách comment mà không cần tải lại trang
                },
                error: function () {
                    // Xử lý lỗi nếu có
                }
            });
        }
        // Xử lý sự kiện khi nhấn nút "Delete"
        $("#delete-btn").click(function (event) {
            event.preventDefault(); // Ngăn chặn hành động mặc định của form

            // Lấy action của form
            var actionUrl = $("#deleteCommentForm").attr("action");

            // Gửi yêu cầu xóa bằng Ajax
            $.ajax({
                type: "POST",
                url: actionUrl,
                success: function () {
                    // Nếu xóa comment thành công, làm gì đó (ví dụ: cập nhật giao diện)
                    // Sau đó có thể tải lại trang hoặc thực hiện các hành động khác
                    window.location.reload();
                },
                error: function () {
                    // Xử lý lỗi nếu có
                    alert("Đã xảy ra lỗi khi xóa comment.");
                }
            });
        });
    });
</script>

